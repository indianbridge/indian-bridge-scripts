<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Custom City Calendar" title_url=""
		description="Customized calendar for selected city" author="Indian Bridge"
		author_email="indianbridge+calendargadget@gmail.com" screenshot="" thumbnail=""
		height="400" scrolling="true">
    <Require feature="tabs" />
    <Require feature="setprefs" />
    <Require feature="dynamic-height"/>
    <Require feature="minimessage"/>
  </ModulePrefs>
  <UserPref name="cityname" display_name="Customize for City" default_value="" />
  <UserPref name="selectedTab" datatype="hidden"/>
  <Content type="html">
    <![CDATA[
		<script type="text/javascript" src="http://www.google.com/jsapi"></script>
		<script type="text/javascript" src="http://indian-bridge-scripts.googlecode.com/svn/trunk/Utilities.js"></script>
		<script type="text/javascript">
			google.load("gdata", "1");
      var googleLoadedFlag = false; 
      var pageLoadedFlag = false;
			google.setOnLoadCallback(googleLoaded);
      function googleLoaded() {googleLoadedFlag=true;run();}
			var prefs = new gadgets.Prefs();
			var msg = new gadgets.MiniMessage(__MODULE_ID__);
			gadgets.util.registerOnLoadHandler(pageLoaded);
      function pageLoaded() {pageLoadedFlag=true;run();}
			function run() { 
        if(googleLoadedFlag&&pageLoadedFlag) {
          runRegularEvents(); 
          runRecentResults(); 
          runUpcomingEvents();
          //createTabs();
          var statusMsg = msg.createDismissibleMessage("query = "+parent.location.href);
        } 
      }
      function createTabs() {
				var tabSet = new gadgets.TabSet(__MODULE_ID__); 
        tabSet.addTab("Recent Results", {contentContainer: document.getElementById("recent-results"),tooltip: "Recent Results"});        
        tabSet.addTab("Regular Events", {contentContainer: document.getElementById("regular-events"),tooltip: "Regular Events"});        
        tabSet.addTab("Upcoming Events", {contentContainer: document.getElementById("upcoming-events"),tooltip: "Upcoming Events"});        
      }
			function runRegularEvents() {
			    var queryParameters = {};
			    var otherParameters = {};
			    otherParameters.cityName = "chennai";
			    otherParameters.divId = "regular-events";
			    otherParameters.recurring = true;
			    queryParameters.OrderBy = "starttime";
			    queryParameters.SortOrder = "ascending";
			    queryParameters.SingleEvents = false;
			    queryParameters.MaxResults = 30;
			    var today = new Date();
			    var endDate = new Date(today.getTime() + (31 * 24 * 3600000));
			    queryParameters.MinimumStartTime = convertToGoogleDateTime(today);
			    queryParameters.MaximumStartTime = convertToGoogleDateTime(endDate);
			    otherParameters.columns = ["Event Name","Recurrence"];
			    otherParameters.title = "Regular Events in India";
			    getEvents(queryParameters, otherParameters);
			}
			function runRecentResults() {
          var queryParameters = {};
          var otherParameters = {};
          otherParameters.divId = "recent-results";
          queryParameters.MaxResults = 10;
          queryParameters.OrderBy = "starttime";
          queryParameters.SortOrder = "ascending";
          var endDate = new Date();
          var startDate = new Date(endDate.getTime() - (31 * 24 * 3600000));
          queryParameters.MinimumStartTime = convertToGoogleDateTime(startDate);
          queryParameters.MaximumStartTime = convertToGoogleDateTime(endDate);
          queryParameters.SingleEvents = true;
          otherParameters.columns = ["Event Name", "Event Date", "Results Link"];
          otherParameters.title = "Recent Results in Chennai";
          getEvents(queryParameters, otherParameters);
      }
			function runUpcomingEvents() {
			    var queryParameters = {};
			    var otherParameters = {};
			    otherParameters.divId = "upcoming-events";
			    queryParameters.MaxResults = 10;
			    queryParameters.OrderBy = "lastmodified";
			    queryParameters.SortOrder = "descending";
			    queryParameters.SingleEvents = true;
			    queryParameters.FutureEvents = true;
			    otherParameters.columns = ["Event Name", "Event Date"];
			    otherParameters.title = "Upcoming Events in Chennai";
			    getEvents(queryParameters, otherParameters);
			}     
      
		</script>
		<div id="recent-results">Loading Events ...1</div>
		<div id="regular-events">Loading Events ...1</div>
		<div id="upcoming-events">Loading Events ...1</div>
		]]>
  </Content>
</Module>